<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"/>
<link rel="stylesheet" href="css/style.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin="anonymous" />
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script>
	$(document).ready(function(){
		$('#dotto ul li').each(function(){
		var bu = $(this);
		var id = $(this).data('id');
			$(this).find('.click-dots').on('click',function(){
			if(!bu.hasClass('dotto-active')){
				$('#dotto > ul > li').removeClass('dotto-active');
				$('#dm-post .dotto-container').stop().slideUp();
				bu.addClass('dotto-active');
				$('#dm-post .dotto-container[data-id="'+id+	'"]').stop().slideDown();
				}
			});
		});
	});
</script>

<script src="https://www.gstatic.com/firebasejs/8.2.4/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.4/firebase-analytics.js"></script>
<script>
$(function () {
  $('[data-toggle="tooltip"]').tooltip()
})
  var firebaseConfig = {
    apiKey: "AIzaSyDczogySvDZwXEATmZIKQQAIH0sP_P50Vw",
    authDomain: "datamotto-16e2c.firebaseapp.com",
    databaseURL: "https://datamotto-16e2c-default-rtdb.firebaseio.com",
    projectId: "datamotto-16e2c",
    storageBucket: "datamotto-16e2c.appspot.com",
    messagingSenderId: "522613364093",
    appId: "1:522613364093:web:b87810bc81f4495e8b2814",
    measurementId: "G-K4HSBHXJNW"
  };
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
  var database = firebase.database();
  var like_db = database.ref("/like");

function getIP(){
let getIP = '';
$.ajax({
  url: 'https://json.geoiplookup.io/api',
  dataType: 'json',
  async: false,
  success: function(data) {
    getIP = data.ip;
  }
});
return getIP;
}

function countElement(item,array) {
    var count = 0;
    $.each(array, function(i,v) {
		if (v.post_id == item) count++;
	});
    return count;
}

function update_db(){
like_db.on("value", function(snapshot) {
var total_likes = [];

snapshot.forEach(function(childSnapshot) {
  var childData = childSnapshot.val();
  total_likes.push(childData);

  $('.dm-rep-btn').each(function(){
	if($(this).data('post-id') == childSnapshot.val().post_id && childSnapshot.val().ip == getIP()){
		$(this).attr('data-uid', childSnapshot.key);
	}
	});
});
$('.total-likes').each(function(){
	var pid = $(this).data('post-id');
	$(this).html(countElement(pid,total_likes));
});
});
}

update_db();


$(document).ready(function(){

let dottos = $('#dotto ul li').length;
if(dottos <= 1){
	$('#dotto ul').removeClass('hasDotto');
}


	let likeCookie = localStorage.getItem("like") ? localStorage.getItem("like").split(',') : [];

	// check if liked
	$('.dm-rep-btn').each(function(){
	let post_id = $(this).data('post-id').toString();

	if($.inArray(post_id, likeCookie) === -1){
	} else {
	$(this).addClass('liked');
	}
	});

	// new like



	$('.dm-rep-btn').each(function(){
	let status = true;
	$(this).click(function(){
	let bu = $(this);
	let post_id = bu.data('post-id').toString();


	if(status){
		status = false;
		likeCookie.splice( $.inArray(post_id, likeCookie), 1);
		like_db.child(bu.data('uid')).remove();
	} else {
		status = true;
		likeCookie.push(post_id.toString());
		like_db.push({
			post_id: post_id,
			ip: getIP(),
			created_at: new Date()
		});
	}

	/*if(bu.hasClass('liked')){
	bu.removeClass('liked');
	likeCookie.splice( $.inArray(post_id, likeCookie), 1);

	like_db.child(bu.data('uid')).remove();
	} else {
		bu.addClass('liked');
		likeCookie.push(post_id.toString());
		like_db.push({
			post_id: post_id,
			ip: getIP(),
			created_at: new Date()
		});
	}*/

	localStorage.setItem("like", likeCookie);

	});
	});

	});
</script>

<section id="dm-post-header">
<div class="container">
<header id="dm-header" class="pt-3 pb-2 clearfix">
<div id="dm-logo" class="float-left">
<div class="dm-logo-dot"></div>
<div class="dm-logo-dot"></div>
<div class="dm-logo-dot"></div>
<span>DATA MOTTO</span>
</div>
<nav class="float-left pl-5 pt-2" id="dm-nav">
<ul class="row">
<li class="d-inline-block"><a href="#">HOME</a></li>
<li class="d-inline-block pl-4"><a href="#">THE WHOLE GAME!</a></li>
<li class="d-inline-block pl-4"><a href="#">BLOG</a></li>
<li class="d-inline-block pl-4"><a href="#">ABOUT</a></li>
</ul>
</nav>
<button class="float-right btn gradient-button text-white rounded-pill">GET STARTED</button>

</header>
</div>
</section>

<section id="dm-post" class="pt-4">
<div class="container">
<div class="row">

<div id="dotto" class="col-1 pr-0 pl-0">
<ul class="hasDotto">
<li class="dotto-active" data-id="1">
<div class="dm-rep">
	<div class="dm-rep-btn" data-post-id="1"><i class="fas fa-caret-up"></i></div>
</div>
<div class="total-likes" data-post-id="1">0</div>
<div class="dotto-dots click-dots" data-toggle="tooltip" data-placement="top" title="Test Title"></div>
</li>
<li data-id="2">
<div class="dm-rep">
	<div class="dm-rep-btn" data-post-id="2"><i class="fas fa-caret-up"></i></div>
</div>
<div class="total-likes" data-post-id="2">0</div>
<div class="dotto-dots click-dots" data-toggle="tooltip" data-placement="top" title="Test Title"></div>
</li>
<li data-id="3">
<div class="dm-rep">
	<div class="dm-rep-btn" data-post-id="3"><i class="fas fa-caret-up"></i></div>
</div>
<div class="total-likes" data-post-id="3">0</div>
<div class="dotto-dots click-dots" data-toggle="tooltip" data-placement="top" title="Test Title"></div>
</li>
</ul>
</div>

<div id="dotto-content" class="col-11 pr-0 pl-0">
<div class="dotto-container" style="display: block;" data-id="1">
<div id="dm-desc">
<div class="row">
	<div class="col-6">
	<h2>New York Taxi fare rate</h2>
	<p>A short description of the post.</p>
	</div>
	<div class="col-4">
<div id="dm-techs">
<i class="fab fa-python"></i>
</div>
<div id="dm-tags" class="pt-2">
<span class="badge badge-pill badge-info">Visualization</span>
</div>

	</div>
	<div class="col-2">
<div class="dm-posts-desc">
<span class="pr-1"><i class="far fa-clock"></i> Jan. 3, 2021</li>
<br/>
<span><i class="far fa-user"></i> Ardalan Mirshani</li>
</div>
	</div>
</div>
</div>

<ul class="nav nav-tabs">
<li class="nav-item">
<a class="nav-link active" data-toggle="tab" href="#DM-Intro">Intro</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="#DM-Data">Data</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="#DM-Cleaning">Cleaning</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="#DM-Visulization">Visulization</a>
</li>
</ul>

<div class="tab-content mb-5 pt-3 pl-4">
<div class="tab-pane container active" id="DM-Intro">

</div>
<div class="tab-pane container fade" id="DM-Data">Data</div>
<div class="tab-pane container fade" id="DM-Cleaning">Cleaning</div>
<div class="tab-pane container fade" id="DM-Visulization">Visulization</div>
</div>
</div>

<div class="dotto-container" style="display: none;" data-id="2">
<div id="dm-desc">
<div class="row">
	<div class="col-6">
	<h2>Covid 19</h2>
	<p>A short description of the post.</p>
	</div>
	<div class="col-4">
<div id="dm-techs">
<i class="fab fa-python"></i>
</div>
<div id="dm-tags" class="pt-2">
<span class="badge badge-pill badge-info">Visualization</span>
</div>
	</div>
	<div class="col-2">
<div class="dm-posts-desc">
<span class="pr-1"><i class="far fa-clock"></i> Jan. 3, 2021</li><br/>
<span><i class="far fa-user"></i> Ardalan Mirshani</li>
</div>
	</div>
</div>
</div>

<ul class="nav nav-tabs">
<li class="nav-item">
<a class="nav-link active" data-toggle="tab" href="#DM-Intro">Intro</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="#DM-Data">Data</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="#DM-Cleaning">Cleaning</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="#DM-Visulization">Visulization</a>
</li>
</ul>

<div class="tab-content mb-5 pt-3 pl-4">
<div class="tab-pane container active" id="DM-Intro">
</div>
<div class="tab-pane container fade" id="DM-Data">Data</div>
<div class="tab-pane container fade" id="DM-Cleaning">Cleaning</div>
<div class="tab-pane container fade" id="DM-Visulization">Visulization</div>
</div>

</div>

<div class="dotto-container" style="display: none;" data-id="3">
<div id="dm-desc">
<div class="row">
	<div class="col-6">
<h2>New York Taxi fare rate</h2>
<p>A short description of the post.</p>
	</div>
	<div class="col-4">
<div id="dm-techs">
<i class="fab fa-python"></i>
</div>
<div id="dm-tags" class="pt-2">
<span class="badge badge-pill badge-info">Visualization</span>
</div>
	</div>
	<div class="col-2">
<div class="dm-posts-desc">
<span class="pr-1"><i class="far fa-clock"></i> Jan. 3, 2021</li><br/>
<span><i class="far fa-user"></i> Ardalan Mirshani</li>
</div>
	</div>
</div>
</div>

<ul class="nav nav-tabs">
<li class="nav-item">
<a class="nav-link active" data-toggle="tab" href="#DM-Intro">Intro</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="#DM-Data">Data</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="#DM-Cleaning">Cleaning</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="#DM-Visulization">Visulization</a>
</li>
</ul>

```{r}

```

<div class="tab-content mb-5 pt-3 pl-4">
<div class="tab-pane container active" id="DM-Intro">
</div>
<div class="tab-pane container fade" id="DM-Data">Data</div>
<div class="tab-pane container fade" id="DM-Cleaning">Cleaning</div>
<div class="tab-pane container fade" id="DM-Visulization">Visulization</div>
</div>

</div>
</div>

</div>
</div>
</section>

<footer id="dm-footer" class="pt-3 pb-3">
<div class="container">
<div id="dm-social" class="text-center">
<a href="https://twitter.com/DataMotto" class="fab fa-twitter"></a>
<a href="https://www.linkedin.com/company/datamotto" class="fab fa-linkedin"></a>
<a href="https://Datamotto.slack.com" class="fab fa-slack"></a>
</div>
<div id="dm-copy" class="text-center mt-3">copyright <i class="fas fa-copyright"></i> 2021</div>
</div>
</footer>
